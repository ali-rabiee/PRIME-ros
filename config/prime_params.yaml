# PRIME System Parameters

# Robot configuration
robot:
  type: "j2n6s300"  # Kinova Jaco2 6-DOF
  driver_prefix: "/j2n6s300_driver"
  
# Workspace grid configuration (3x3 as per paper)
workspace:
  grid_rows: 3
  grid_cols: 3
  # Workspace bounds in robot base frame (meters)
  x_min: 0.2
  x_max: 0.7
  y_min: -0.4
  y_max: 0.4
  z_min: 0.0
  z_max: 0.5

# Option A (recommended): AprilTag-based mapping (no depth)
# - Uses camera intrinsics + AprilTag pose to ray-cast pixels onto the tag plane
# - Requires a one-time calibration of the tag pose in robot root frame (root_T_tag)
workspace_tag:
  enabled: true
  # AprilTag ID printed on the tag
  tag_id: 0
  # Tag black-square edge length in meters (border between black/white)
  tag_size: 0.18
  # Plane to intersect in tag frame (z=0 is the tag plane)
  tag_plane_z: 0.0
  # Topics (apriltag_ros publishes /tag_detections by default)
  tag_detections_topic: "/tag_detections"
  camera_info_topic: "/camera/color/camera_info"
  # Stabilization: lock the camera->tag pose after N detections (camera fixed per episode)
  lock_pose: true
  lock_after_n: 15
  # Fixed calibration: robot root -> tag frame.
  # For a first test, if you align the tag edges with robot axes, you can keep rpy = [0,0,0]
  # and set translation to the tag center measured in the robot root frame.
  root_T_tag:
    translation: [0.02, -0.85, 0.36]   # meters
    rpy: [0.0, 0.0, 0.0]              # radians (roll, pitch, yaw)
    # Per-axis sign correction applied after rotation, before translation.
    # Use [-1, 1, 1] if tag X is flipped relative to robot X.
    axis_signs: [-1.0, 1.0, 1.0]

# Safety boundary (recommended ON for real robot)
# Used for:
# - PRIME MoveIt tool-call validation (won't plan outside)
# - Optional Kinova firmware protection zones (stops hardware joystick too when applied)
safety_bounds:
  enabled: true
  frame_id: "root"
  x_min: -0.26
  x_max: 0.33
  y_min: -0.7
  y_max: -0.33
  z_min: 0.20
  z_max: 0.60
  # How far the forbidden “outside slabs” extend beyond the bounds (meters)
  outer_extent: 2.0
  # Add planning-scene walls in MoveIt (helps planning respect limits)
  add_moveit_walls: false
  wall_thickness: 0.02

# State builder parameters
state_builder:
  gripper_history_length: 10  # Number of timesteps to keep
  update_rate: 10.0  # Hz
  position_threshold: 0.02  # meters, minimum movement to update history
  # Stabilization for YOLO detections -> PRIME objects
  min_object_confidence: 0.5
  track_max_age: 1.0            # seconds (keeps IDs stable through brief misses)
  track_max_pixel_dist: 80.0    # pixels (matching radius for tracking)
  track_smoothing_alpha: 0.35   # 0..1 (EMA smoothing on position/centroid)

# Candidate selection parameters
candidates:
  # Nearby threshold for candidate initialization
  neighbor_threshold: 1  # grid cells
  # Motion direction threshold for candidate inclusion
  direction_threshold: 0.3  # radians

# LLM configuration
llm:
  model: "qwen2.5"
  endpoint: "http://localhost:11434/api/generate"  # Ollama default
  temperature: 0.3
  max_tokens: 500
  timeout: 30.0  # seconds

# User interface configuration
ui:
  query_timeout: 30.0  # seconds
  # Button mapping for Kinova joystick (adjust based on your setup)
  button_yes: 0
  button_no: 1
  button_option_1: 2
  button_option_2: 3
  button_option_3: 4
  button_option_4: 5
  button_option_5: 6

# Tool execution parameters
tools:
  approach:
    pre_grasp_distance: 0.10  # meters above object
    approach_speed: 0.1  # m/s
  align:
    tolerance: 0.1  # radians
  grasp:
    finger_close_position: 5000  # Kinova units (0-6800)
    finger_open_position: 0

# Memory configuration
memory:
  max_dialog_history: 20
  max_tool_history: 10

# Topics
topics:
  camera_color: "/camera/color/image_raw"
  camera_depth: "/camera/aligned_depth_to_color/image_raw"
  yolo_detections: "/yolo/image_with_bboxes"
  tool_pose: "/j2n6s300_driver/out/tool_pose"
  finger_position: "/j2n6s300_driver/out/finger_position"
  joint_state: "/j2n6s300_driver/out/joint_state"
